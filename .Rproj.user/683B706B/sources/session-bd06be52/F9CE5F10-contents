---
title: "Форматы пространственных данных"
subtitle: "Геоинформатика и геоинформационные системы. Лекция 2"
author: "Балтыжакова Татьяна Игоревна"
format: 
  revealjs:
    slide-number: true
    theme: [default, custom.css]
    footer: "Балтыжакова Т.И. Геоинформатика и геоинформационные системы: лекции"
    margin: 0.1
    reference-location: document
    width: 1800
    height: 1000
---

# Что такое эти самые пространственные данные?

Фактически любые данные, которые содержат сведения о местоположении объекта.

Но, если говорить формально

. . .

**пространственные данные** (spatial data): *Данные о пространственных объектах, включающие сведения об их форме, местоположении и свойствах, в том числе представленные с использованием координат.*[^1]

[^1]: ГОСТ Р 57657-2017 (ИСО 19131:2007) Пространственные данные. Спецификация информационного продукта

------------------------------------------------------------------------

::::: columns
::: {.column width="50%"}
**пространственный объект** (feature): Цифровая модель материального или абстрактного объекта реального или виртуального мира с указанием его идентификатора, координатных и атрибутивных данных.

**атрибут пространственного объекта** (feature attribute): Характеристика пространственного объекта.
:::

::: {.column width="50%"}
![](images/clipboard-531483221.png)
:::
:::::

# Дискретные и непрерывные данные

::::: columns
::: {.column width="45%"}
***Дискретные пространственные объекты имеют четко определенные границы.***

Например, административные границы, здания, точки притяжения, земельные участки.
:::

::: {.column width="45%"}
***Непрерывные данные представляют собой поверхность (или поле), в каждой точке которой известно значение параметра и не имеющая четких границ.***

Например, рельеф, значение гравитационного поля
:::
:::::

Это и определяет два основных типа пространственных данных - векторные и растровые.

------------------------------------------------------------------------

![](images/clipboard-659462666.png){fig-align="center"}

------------------------------------------------------------------------

![Источник: https://rsgislearn.blogspot.com/2007/05/vector-data-vs-raster-data.html](images/clipboard-1959405377.png){fig-align="center"}

# Растровые данные

![](images/clipboard-202558759.png){fig-align="center"}

Информация в растровых данных содержится в пикселях - от английского *picture element* или *pix element*. Одним из ранних названий было `pel` (им в основном пользовались в **Bell labs - Лабораториях Белла**).

------------------------------------------------------------------------

## Факт

Первый ГИС использовали только растровые данные, так как на тот момент это был единственный способ отображения чего-либо на экране. Векторные специализированные форматы появились только в 80-х годах.

::: callout-important
Точность растровых данных ограничена их разрешением, то есть размером пикселя: чем меньше пиксель, тем более качественным будет изображение. При этом с уменьшением размера пикселя возрастает размер файла, в среднем размер файла будет возрастать в геометрической прогрессии (то есть при уменьшении пикселя в 2 раза, размер файла возрастет примерно в 4 раза).

Но здесь, как правило, стараются найти компромисс между качеством данных и размером файла.
:::

# GeoTIFF

[**GeoTIFF**](https://ru.wikipedia.org/wiki/GeoTIFF) - открытый формат представления растровых данных в формате TIFF совместно с метаданными о географической привязке (геореференцированный растр).

Использует спецификации TIFF 6.0, в которую добавляет несколько видов геотегов, которые определяют вид картографической проекции, систему географических координат, модель геоида, датум и любую другую информацию, необходимую для точного пространственного ориентирования изображения.[^2]

[^2]: Описание стандарта OCG GeoTIFF <https://www.ogc.org/standards/geotiff/>

Приложения, поддерживающие только формат TIFF 6.0, но не GeoTIFF, могут открывать изображения, получая базовый растр без метаинформации.

------------------------------------------------------------------------

В тегах GeoTIFF может задаваться:

-   Вид картографической проекции или систему географических координат

-   Параметры (датум) земного геоида

-   Дискреты разрешения изображения

-   Матрицу полиномиального, сплайнового или аффинного преобразования

-   Характерные параметры изображения

# Web map service (WMS)

**WMS (Web map service)** - это протокол получения через Интернет географически привязанных изображений, которые генерируются картографическим сервером на основе базы данных.[^3]

[^3]: Описание стандарта и спецификация протокола <https://www.ogc.org/standards/wms/>

![Источник: https://community.digitalparos.com/d/11-digitalparos-development-updates-2](images/clipboard-200864657.png){alt="Источник: https://community.digitalparos.com/d/11-digitalparos-development-updates-2" fig-align="center" width="1132"}

# Векторные данные

В векторных данных для задания местоположения используются координаты объектов и математические формулы для задания формы.

Специализированные форматы, предназначеннные для ГИС, разработаны так, чтобы они могли ***совмещать в себе сразу и геометрию, и атрибутивные данные (непространственные характеристики)***.

------------------------------------------------------------------------

Главная особенность векторных форматов данных, используемых в ГИС в том, что они позволяют не только определять местоположение и геометрию обьектов, но и также их описательные непространственные характеристики (то, что, как правило, называют атрибутивными данными). Кроме того, большинство из этих форматов поддерживают работу с различными картографическими проекциями и системами координат.

Например, системы автоматизированного проектирования (AutoCAD, NanoCAD и подобные им) также могут работать с геометрическими характеристиками объектов и их местоположением, но работа в них осуществляется только в плоской прямоугольной системе координат, а возможность работы с атрибутивными данными отсутствует.

# Shapefile

![](images/clipboard-1672673853.png){fig-align="center" width="641"}

Наиболее часто используемым форматом векторных данных в ГИС является **shapefile**[^4]. Этот проприетарный формат данных от компании ESRI, который был разработан ими в 90-х годах прошлого века. Это был первый формат векторых данных, созданный специально для работы в ГИС.

[^4]: ESRI Shapefile Technical Description --- Электрон. дан. --- <https://www.esri.com/content/dam/esrisites/sitecore-archive/Files/Pdfs/library/whitepapers/pdfs/shapefile.pdf>

------------------------------------------------------------------------

При использовании этого формата данные хранятся в нескольких файлах с разными расширениями, обязательными из которых являются:

\- **.shp** - геометрия объектов;

\- **.shx** - файл индексов необходим для ускорения расчетов и связи геометрии и атрибутов;

\- **.dbf** - таблица атрибутов:

\- **.prj** - сведения о проекции и системе координат.

::: callout-caution
Как минимум для корректной работы необходимы первые три файла. Файл .prj формально не является обязательным, но без него ГИС не сможет определить, какая система координат используется.
:::

------------------------------------------------------------------------

![](images/clipboard-3571769684.png){fig-align="center" width="666"}

------------------------------------------------------------------------

Недостатки работы с shape файлами[^5]:

[^5]: Switch from Shapefile <http://switchfromshapefile.org/>

-   в файле не задается система координат;

-   состоит из нескольких файлов;

-   названия атрибутов должны быть не длинее 10 букв;

-   всего можно добавить не более 255 атрибутов;

-   ограниченное количество типов данных в атрибутах;

-   файл должен быть не более 2 Гигабайт;

-   не описываются топологические отношения объектов;

-   в файле могут быть только объекты с одним типом геометрии;

-   и прочие.

Вот здесь еще можно посмотреть презентацию про shape файлы и их альтернативы <https://www.slideshare.net/jachym/switch-from-shapefile>

# GeoPackage

**GeoPackage**[^6] - это *контейнер SQLite*, а стандарт кодирования GeoPackage определяет правила и требования к контенту, хранящемуся в контейнере.

[^6]: Getting Started With GeoPackage --- Электрон. дан. --- <http://www.geopackage.org/guidance/getting-started.html>

![](images/clipboard-625967847.png){fig-align="center" width="422"}

------------------------------------------------------------------------

Стандарт GeoPackage определяет схему, включая определения таблиц, утверждения целостности, ограничения формата и ограничения содержимого. Требуемый и поддерживаемый контент GeoPackage полностью определен в стандарте. Эти возможности построены на общей основе, и механизм расширения предоставляет разработчикам возможность включить дополнительные функции в свои GeoPackages.

Стандарт кодирования GeoPackage описывает набор соглашений для хранения следующего в базе данных SQLite:

-   векторные объекты;

-   наборы тайловых матриц изображений и растровых карт в различных масштабах;

-   атрибуты (непространственные данные);

-   дополнения.

# GeoJSON

**GeoJSON** - формат представления различных структур географических данных, основанный на [JavaScript object notation (JSON)](https://ru.wikipedia.org/wiki/JSON).

В GeoJSON объект состоит из набора пар *ключ/значение*, также называемых свойствами. Имя каждого свойства -- строка. Значение свойства может представлять собой строку, число, объект, массив или один из литералов: «true», «false» и «null». Массив состоит из элементов, где каждый элемент может принимать одно из значений, описанных выше.

------------------------------------------------------------------------

Пример GeoJSON:

```         
{
  "type": "Feature",
  "geometry": {
    "type": "Point",
    "coordinates": [125.6, 10.1]
  },
  "properties": {
    "name": "Dinagat Islands"
  }
}
```

------------------------------------------------------------------------

Формат поддерживает следующие типы объектов `Point`, `LineString`, `Polygon`, `MultiPoint`, `MultiLineString`, and `MultiPolygon`.

Геометрические объекты с атрибутивными характеристиками составляют `Feature` объекты. Наборы объектов хранятся как `FeatureCollection` объекты[^7]. Полное описание формата представлено [здесь](https://datatracker.ietf.org/doc/html/rfc7946).

[^7]: <https://geojson.org/>

Для проверки и валидации geojson файлов можно пользоваться сервисом [geojson.io](https://geojson.io/)

Существует еще дополненная версия **topojson**, в котором учитываются топологические отношения между объектами. В этом формате вместо того, чтобы представлять геометрию дискретно, геометрия в файлах TopoJSON сшивается из общих линейных сегментов, называемых *дугами*[^8].

[^8]: <https://github.com/topojson/topojson>

# WKT

**WKT (Well-known text)** — текстовый формат представления векторной геометрии и описания систем координат[^9].

[^9]: <https://ru.wikipedia.org/wiki/WKT>

::: callout-important
Этот формат может использоваться как для описания геометрии объектов, так и для задания параметров систем координат (об этом мы поговорим в более поздних темах).
:::

------------------------------------------------------------------------

WKT может представлять следующие геометрические объекты:

-   Point, MultiPoint

-   LineString, MultiLineString

-   Polygon, MultiPolygon

-   CircularString

-   Curve, MultiCurve, CompoundCurve

-   CurvePolygon

-   Surface, MultiSurface

-   TIN ([Triangulated irregular network](https://ru.wikipedia.org/w/index.php?title=Triangulated_irregular_network&action=edit&redlink=1 "Triangulated irregular network (страница отсутствует)"))

-   GeometryCollection

------------------------------------------------------------------------

![](images/clipboard-368845347.png){fig-align="center"}

# KML

**KML** - это формат файлов, который используется для отображения географических данных в геобраузерах, таких как Google Планета Земля, Google Карты и Google Карты для мобильных устройств. KML создан на основе стандарта XML и использует основанную на тегах структуру с вложенными элементами и атрибутами[^10].

[^10]: О формате KML <https://cartetika.ru/tpost/jl4hk9a1r1-o-formate-kml>

. . .

*Заголовок XML*: с него начинается каждый KML-файл. Перед заголовком не должно быть никаких символов или пробелов.

*Декларация пространства имен KML*: вторая строка каждого файла формата KML 2.2.

*Объект Placemark*, содержащий следующие элементы: name - имя, которое используется в качестве ярлыка метки;

*description* - описание, которое отображается во всплывающем окне, привязанном к метке;

*Point* - координаты, определяющие положение метки на земной поверхности (долгота и широта, иногда также высота).

------------------------------------------------------------------------

```         
KML-код простой метки. 
<?xml version="1.0" encoding="UTF-8"?>
      <kml xmlns="http://www.opengis.net/kml/2.2"> <Placemark>
      <name>Простая метка</name>
      description>Привязана к земной поверхности. Приспосабливается к рельефу местности.</description>
      <Point>
      <coordinates>-122.0822035425683,37.42228990140251,0</coordinates>
      </Point>
      </Placemark> </kml>
```

# GPX

[**GPX**](https://ru.wikipedia.org/wiki/GPX) **(англ. GPS eXchange Format)** - свободный текстовый формат хранения и обмена данными GPS, основанный на XML.

Формат позволяет хранить информацию об *ориентирах (waypoints), маршрутах (routes) и треках (tracklogs)*.

. . .

Для каждой точки хранятся её ***долгота, широта и высота над уровнем моря*** (если имеется информация о высоте). Для точек трека хранится также время прохождения точки.

------------------------------------------------------------------------

XML-схема предусматривает также хранение *произвольной пользовательской информации* по каждой точке, обязательными являются только долгота и широта.

. . .

Широта и долгота в GPX указывается в градусах в общегеографической системе координат.

Высота указывается в метрах над уровнем моря.

Примером пользовательской информации может быть *высота местности (ele), скорость, частота пульса (hr), число шагов, темп вращения педалей (каденс, cad)*, температура и им подобные параметры.

------------------------------------------------------------------------

```         
<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.0">
    <name>Example gpx</name>
    <wpt lat="46.57638889" lon="8.89263889">
        <ele>2372</ele>
        <name>LAGORETICO</name>
    </wpt>
    <trk><name>Example gpx</name><number>1</number><trkseg>
        <trkpt lat="46.57608333" lon="8.89241667"><ele>2376</ele><time>2007-10-14T10:09:57Z</time></trkpt>
        <trkpt lat="46.57619444" lon="8.89252778"><ele>2375</ele><time>2007-10-14T10:10:52Z</time></trkpt>
        <trkpt lat="46.57641667" lon="8.89266667"><ele>2372</ele><time>2007-10-14T10:12:39Z</time></trkpt>
        <trkpt lat="46.57650000" lon="8.89280556"><ele>2373</ele><time>2007-10-14T10:13:12Z</time></trkpt>
        <trkpt lat="46.57638889" lon="8.89302778"><ele>2374</ele><time>2007-10-14T10:13:20Z</time></trkpt>
        <trkpt lat="46.57652778" lon="8.89322222"><ele>2375</ele><time>2007-10-14T10:13:48Z</time></trkpt>
        <trkpt lat="46.57661111" lon="8.89344444"><ele>2376</ele><time>2007-10-14T10:14:08Z</time></trkpt>
    </trkseg></trk>
</gpx>
```

---

## Web feature service (WFS) и векторные тайлы

**Web Feature Service (WFS)** — стандарт, который позволяет возвращать векторные геометрии и их атрибуты.

> В отличие от растровых тайлов, векторные представляют собой не изображения, а двоичные файлы в формате PBF (protobuf, бинарная альтернатива XML; хотя более современные стандарты поддерживают формат JSON). Они содержат всю необходимую информацию для генерации карты на стороне клиента. В стиле карты также указывается, следует ли вообще отображать элемент веб-карты, и какой шрифт и язык использовать для надписей[^11].

[^11]: **Разница между векторными и растровыми тайлами в веб-картах** <https://cartetika.ru/tpost/2tecy4r8f1-raznitsa-mezhdu-vektornimi-i-rastrovimi>

Как правило, векторные тайлы менее ресурсоемки, чем растровые, так как передаваемые файлы меньше. На их загрузку нужно меньше времени, достаточно меньшей пропускной способности.

Кроме того, как и любой векторный формат представления данных они предполагают лучшее качество, чем растры, при меньшем размере файлов.

------------------------------------------------------------------------

![Источник: https://www.esri.com/arcgis-blog/products/developers/developers/arcgis-hosted-services-explained-feature-vector-map-tiles-services](images/clipboard-2787109949.png){alt="Источник: https://www.esri.com/arcgis-blog/products/developers/developers/arcgis-hosted-services-explained-feature-vector-map-tiles-services" fig-align="center"}
